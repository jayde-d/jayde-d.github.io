<!DOCTYPE html>
<html>
	<head>
	    <meta charset="utf-8" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
	</head>
	<body>
	<h1>Test Page</h1>
	
	<script>
		window.onload = function() {
		
		var queryString = window.location.search;
		var urlParams = new URLSearchParams(queryString);
		
		var seed = urlParams.get("seed");
		var dir = urlParams.get("directory");
		var splitDir = dir.split("/");
		
		console.log(seed);
		console.log(dir)
		
		console.log(splitDir[2]+"/"+splitDir[3]);
		
		var DBOpenRequest = window.indexedDB.open("/idbfs");
		var db;
		var objects = new Array();
		var images = new Array();


		DBOpenRequest.onsuccess = function(event) {
			console.log("SUCCESS!");
			db = DBOpenRequest.result;
			var transaction = db.transaction("FILE_DATA", "readwrite");
			
			var objectStore = transaction.objectStore("FILE_DATA");
			var objectsRequest = objectStore.getAll();

			objectsRequest.onsuccess = function()
			{
				objects = objectsRequest.result;
				console.log(objects);
				objects.forEach(forEachFunction);
			}
		}

		
		function forEachFunction (item, index)
		{
			var counter;
			//console.log(item);
			if(item.mode == 33206)
			{
				images.Push(item.contents)
				counter++;
			}
			console.log("counter: " + counter);
			console.log(images);
		}
		
		
		
		
		
		const { jsPDF } = window.jspdf;
		
		// Default export is a4 paper, portrait, using millimeters for units
		const doc = new jsPDF();

		doc.setDrawColor(128, 128, 128); // draw grey lines
		doc.setLineWidth(0.1);
		 
		doc.line(105, 20, 105, 74.25);
		doc.line(105, 222.75, 105, 277);
		
		// 0
		doc.line(20, 74.25, 190, 74.25);
		doc.line(20, 148.5, 190, 148.5);
		doc.line(20, 222.75, 190, 222.75);
		// 297
		
		doc.setLineDashPattern([2.5]);
		//doc.setLineWidth(0.5);
		//doc.line(105, 20, 105, 277);
		doc.line(105, 74.25, 105, 222.75);
		doc.rect(1, 1, 208, 295);

		//doc.text("Hello world!", 10, 10);
		
		doc.text("1", 100, 259.875, align = "center" , rotate = 0);
		doc.text("2", 110, 259.875, align = "center" , rotate = 180);
		doc.text("3", 110, 185.625, align = "center" , rotate = 180);
		doc.text("4", 110, 111.375, align = "center" , rotate = 180);
		doc.text("5", 110, 37.125, align = "center" , rotate = 180);
		doc.text("6", 100, 37.125, align = "center" , rotate = 0);
		doc.text("7", 100, 111.375, align = "center" , rotate = 0);
		doc.text("8", 100, 185.625, align = "center" , rotate = 0);		
		
		//END
		doc.save("ZINE.pdf");

		}
	</script>
	</body>
</html>